# 20260214-113637 GitHubAction升级为双镜像构建发布

## 目标
将 GitHub Actions 从单镜像发布升级为一次构建并推送两个镜像：
- 主镜像：`runnode-run-comfyui-ollama`
- sidecar镜像：`runnode-llamacpp-glm5`

## 变更文件
- `.github/workflows/docker-acr.yml`
- `README.md`

## Action改动
### 新增输入参数
- `llamacpp_pr`：用于 sidecar 构建时指定 llama.cpp PR 分支号，默认 `19460`

### 新增镜像变量
- `MAIN_IMAGE=registry.cn-shenzhen.aliyuncs.com/sailfish/runnode-run-comfyui-ollama`
- `SIDECAR_IMAGE=registry.cn-shenzhen.aliyuncs.com/sailfish/runnode-llamacpp-glm5`

### 新增步骤
- 解析 sidecar tag：
  - `<image_version>-llamacpp-pr-<llamacpp_pr>`
- 构建并推送 sidecar 镜像：
  - Dockerfile: `sidecar/llamacpp-glm5/Dockerfile`

### latest标签逻辑
- `push_latest=true` 时，主镜像和 sidecar 镜像都会打 `latest`

## 标签规则
- 主镜像：
  - `<image_version>-comfyui-<comfyui_version>-ollama-<ollama_version>`
- sidecar镜像：
  - `<image_version>-llamacpp-pr-<llamacpp_pr>`

## 结果
发布流程可在同一条 GitHub Action 中完整产出主服务与 GLM5 sidecar 两个镜像，便于版本对齐和回滚。
