# 20260213-225940 DockerCompose完整部署与环境变量配置说明

## 目标
新增可直接运行的 `docker-compose.yml`，并明确项目支持通过环境变量配置的参数。

## 新增文件
- `docker-compose.yml`
- `.env.example`

## docker-compose能力
- 镜像来源：阿里云 ACR
- 支持 NVIDIA GPU（`gpus: all`）
- 暴露服务端口：
  - ComfyUI: `8188`
  - code-server: `9000`
  - Gradio: `7860`
  - Ollama API: `11434`
  - SSH: `22`（默认映射到宿主机 `2222`）
- 持久化挂载：
  - `./workspace:/workspace`
  - `ollama_data:/root/.ollama`

## 可通过环境变量配置的参数
- 镜像与端口
  - `IMAGE_TAG`
  - `COMFYUI_PORT`
  - `CODE_SERVER_PORT`
  - `GRADIO_PORT`
  - `OLLAMA_PORT`
  - `SSH_PORT`
- 鉴权/访问
  - `PASSWORD`
  - `PUBLIC_KEY`
  - `HF_TOKEN`
- 运行行为
  - `COMFYUI_EXTRA_ARGUMENTS`
  - `DEPLOY_GLM5_UD_IQ2_XXS`
- Ollama模型自动拉取
  - `OLLAMA_MODEL1`
  - `OLLAMA_MODEL2`
  - `OLLAMA_MODEL3`
  - `OLLAMA_MODEL4`
  - `OLLAMA_MODEL5`
  - `OLLAMA_MODEL6`

## 使用方式
1. 复制变量模板
```bash
cp .env.example .env
```
2. 根据实际需求修改 `.env`
3. 启动
```bash
docker compose up -d
```
4. 查看日志
```bash
docker compose logs -f
```

## 备注
- `DEPLOY_GLM5_UD_IQ2_XXS=true` 且 `OLLAMA_MODEL1` 为空时，启动脚本会自动设置：
  - `hf.co/unsloth/GLM-5-GGUF:UD-IQ2_XXS`
- 建议宿主机预先安装 NVIDIA Container Toolkit。
