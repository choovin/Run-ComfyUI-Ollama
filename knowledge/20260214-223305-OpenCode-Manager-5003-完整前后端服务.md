# 20260214-223305 OpenCode Manager 默认生产模式并在5003提供完整前后端

## 背景
- 现象：访问 `:5003` 返回 OpenCode WebUI 的 JSON 状态信息，而不是前端页面。
- 原因：`start.sh` 仅启动了 `bun backend/src/index.ts`，且未确保 `NODE_ENV=production`。
- `opencode-manager` 在非生产模式下会返回开发占位 JSON；仅在生产模式才会服务 `frontend/dist` 静态页面。

## 本次修改
1. `start.sh`
- 将 `OPENCODE_STANDALONE_ENABLED` 默认值从 `true` 改为 `false`，避免默认额外启动 `:4096` 的 standalone opencode。
- 启动 manager 前新增：`NODE_ENV=${NODE_ENV:-production}`。
- 启动前检查 `/opt/opencode-manager/frontend/dist` 是否存在并输出日志。
- 就绪检查改为 `GET /api/health`，并额外探测 `/` 的 `Content-Type`，提示是否为 `text/html`（即完整前端已对外服务）。

2. `.env.example`
- 默认 `OPENCODE_STANDALONE_ENABLED=false`。
- 新增 `NODE_ENV=production` 示例项，明确前端页面服务依赖生产模式。

3. `README.md`
- 更新 OpenCode/OpenCode Manager 说明：默认仅启动 manager；standalone 需显式开启。
- 补充 `NODE_ENV=production` 与 `OPENCODE_STANDALONE_ENABLED=false` 示例。

## 部署后预期
- `http://<host>:5003/` 返回前端页面（`Content-Type: text/html`）。
- `http://<host>:5003/api/health` 返回健康检查 JSON。
- 默认不再有 standalone opencode `:4096` 进程（除非手动启用）。

## 备注
- 本地 Windows 环境未配置 WSL，无法执行 `bash -n start.sh`；需在容器/CI 中做最终启动验证。
